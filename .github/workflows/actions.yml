name: Build

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout Repository with Submodules
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Install Visual Studio Build Tools via Chocolatey
        shell: pwsh
        run: |
          $installDir = "C:\MyVS"
          choco install visualstudio2022buildtools --yes `
            --package-parameters "--installPath `"$installDir`" --add Microsoft.VisualStudio.Workload.VCTools --includeRecommended --passive --norestart --wait"

      - name: Build with MSBuild (Release|Win32)
        shell: cmd
        run: |
          call "C:\MyVS\VC\Auxiliary\Build\vcvars32.bat"
          git clone https://github.com/microsoft/Detours.git dependencies/detours
          git clone https://github.com/marzer/tomlplusplus.git dependencies/toml++
          msbuild ArcadeEssentials.sln /p:Configuration=Release /p:Platform=x86 /m

      - name: Upload Binaries
        uses: actions/upload-artifact@v4
        with:
          name: Binaries
          path: ${{ github.workspace }}/build/*
